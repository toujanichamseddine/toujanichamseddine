<bean id="parserPool" class="org.springframework.security.saml.parser.ParserPoolHolder"/>

<!-- Metadata Manager -->
<bean id="metadata" class="org.springframework.security.saml.metadata.CachingMetadataManager">
    <constructor-arg>
        <list>
            <!-- Load Service Provider Metadata from File -->
            <bean class="org.springframework.security.saml.metadata.ExtendedMetadataDelegate">
                <constructor-arg>
                    <bean class="org.springframework.security.saml.metadata.FilesystemMetadataProvider">
                        <constructor-arg>
                            <value>classpath:saml/sp-metadata.xml</value>
                        </constructor-arg>
                    </bean>
                </constructor-arg>
                <constructor-arg>
                    <bean class="org.springframework.security.saml.metadata.ExtendedMetadata">
                        <property name="signMetadata" value="true"/>
                        <property name="requireLogoutRequestSigned" value="false"/>
                    </bean>
                </constructor-arg>
            </bean>
        </list>
    </constructor-arg>
</bean>

<!-- SAML Authentication Provider -->
<bean id="samlAuthenticationProvider" class="org.springframework.security.saml.SAMLAuthenticationProvider">
    <property name="userDetails" ref="samlUserDetailsService"/>
    <property name="forcePrincipalAsString" value="false"/>
</bean>

<!-- Authentication Manager -->
<bean id="authenticationManager" class="org.springframework.security.authentication.ProviderManager">
    <constructor-arg>
        <list>
            <ref bean="samlAuthenticationProvider"/>
        </list>
    </constructor-arg>
</bean>

<!-- Security Filter Chain -->
<http>
    <intercept-url pattern="/saml/**" access="permitAll"/>
    <intercept-url pattern="/**" access="isAuthenticated()"/>
    <logout logout-url="/saml/logout" logout-success-url="/login?logout"/>
    <custom-filter ref="samlFilter" after="EXCEPTION_TRANSLATION_FILTER"/>
</http>

<!-- SAML Filter -->
<bean id="samlFilter" class="org.springframework.security.web.FilterChainProxy">
    <constructor-arg>
        <list>
            <bean class="org.springframework.security.web.DefaultSecurityFilterChain">
                <constructor-arg>
                    <bean class="org.springframework.security.web.util.matcher.AntPathRequestMatcher">
                        <constructor-arg value="/saml/consume"/>
                    </bean>
                </constructor-arg>
                <constructor-arg>
                    <list>
                        <bean class="org.springframework.security.saml.SAMLProcessingFilter">
                            <property name="authenticationManager" ref="authenticationManager"/>
                        </bean>
                    </list>
                </constructor-arg>
            </bean>
        </list>
    </constructor-arg>
</bean>
