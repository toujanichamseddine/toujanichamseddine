public Map<String, Object> getCurrentUserInfo() {
    SAMLUser user = authenticationManager.getCurrentUser();
    if (user == null) {
        return null;
    }

    Map<String, Object> userInfo = new HashMap<>();
    userInfo.put("username", user.getUsername());
    userInfo.put("email", user.getEmail());
    userInfo.put("utCode", user.getUtCode());
    userInfo.put("roles", user.getRoles());
    userInfo.put("authenticated", true);

    // Ajouter les attributs SAML si disponibles
    Authentication auth = SecurityContextHolder.getContext().getAuthentication();
    if (auth != null && auth.getCredentials() instanceof SAMLCredential) {
        SAMLCredential credential = (SAMLCredential) auth.getCredentials();
        Map<String, String> samlAttributes = new HashMap<>();
        
        for (String attributeName : credential.getAttributes().keySet()) {
            samlAttributes.put(attributeName, credential.getAttributeAsString(attributeName));
        }
        
        userInfo.put("samlAttributes", samlAttributes);
    }

    return userInfo;
}
