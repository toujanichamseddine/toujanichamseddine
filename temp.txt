@Override
    public Authentication authenticate(Authentication authentication) throws AuthenticationException {
        SAMLCredential credential = (SAMLCredential) authentication.getCredentials();

        // Get user details (from SAML or your userDetailsService)
        UserDetails userDetails = userDetailsService.loadUserBySAML(credential);

        // Return a valid authentication token
        return new UsernamePasswordAuthenticationToken(
            userDetails,
            credential,
            userDetails.getAuthorities()
        );
    }
