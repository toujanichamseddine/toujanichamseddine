import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response;
import javax.ws.rs.core.Context;
import javax.servlet.http.HttpServletRequest;

@Path("/getuser")
public class UserResource {

    @GET
    @Produces({MediaType.APPLICATION_JSON, MediaType.TEXT_HTML})
    public Response getUser(@Context HttpServletRequest request) {
        String username = request.getUserPrincipal() != null
                ? request.getUserPrincipal().getName()
                : null;

        if (username == null) {
            // Browser request → redirect
            return Response.status(Response.Status.FOUND)
                           .location(java.net.URI.create("/error/notfound"))
                           .build();
        }

        // Detect if API call (Angular usually sets Accept: application/json)
        String accept = request.getHeader("Accept");
        if (accept != null && accept.contains("application/json")) {
            // API response for Angular
            return Response.ok("{\"user\":\"" + username + "\"}", MediaType.APPLICATION_JSON).build();
        }

        // Browser direct call → redirect
        return Response.status(Response.Status.FOUND)
                       .location(java.net.URI.create("/user/profile"))
                       .build();
    }
}
this.http.get<{user: string}>('/getuser').subscribe(user => {
  console.log('Logged in user:', user);
  // navigate inside Angular if needed
  this.router.navigate(['/dashboard']);
});
